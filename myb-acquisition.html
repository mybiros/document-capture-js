<div id="acquisition-root-component">
    <div class="camera-landscape-wrapper">
        <div id="acquisition-active-camera-container" class="d-none">
            <video src="" id="acquisition-video-source" autoplay muted playsinline></video>
            <div class="acquisition-video-source-controls">
                <div class="acquisition-video-square-control">
                    <div class="acquisition-video-square-control-wrapper">
                        <div class="square-top-left"></div>
                        <div class="square-top-right"></div>
                        <div class="square-bottom-left"></div>
                        <div class="square-bottom-right"></div>
                        <div id="square-info-container">
                            <h5 class="square-info-container-text d-none" id="active-camera-info">
                                Posiziona il documento dentro il riquadro e scatta una foto.
                            </h5>
                            <h5 class="square-info-container-text d-none" id="active-camera-warning">
                                Ruota lo schermo per scattare una foto.
                            </h5>
                        </div>
                    </div>
                    <button class="acquisition-video-screenshot-control" id="acquisition-video-screenshot-control">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="device-cam-screenshot-btn">
                            <!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                            <path
                                d="M149.1 64.8L138.7 96H64C28.7 96 0 124.7 0 160V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V160c0-35.3-28.7-64-64-64H373.3L362.9 64.8C356.4 45.2 338.1 32 317.4 32H194.6c-20.7 0-39 13.2-45.5 32.8zM256 384c-53 0-96-43-96-96s43-96 96-96s96 43 96 96s-43 96-96 96z"
                            />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="acquisition-passive-camera-container d-none">
        <input id="acquisition-passive-camera-input" class="d-none" type="file" capture="environment" accept="image/*" />
    </div>
    <div id="acquisition-processing-container">
        <div class="loader"></div>
    </div>
    <div id="acquisition-steps-container" class="d-none">
        <div id="acquisition-doc-preview-contaner">
            <img src="" alt="" id="acquisition-doc-preview" />
        </div>
        <button id="acquisition-btn" onclick="myBAcqProcess.doNextStep()">Fai una foto del documento (davanti / esterno aperto)</button>
    </div>
</div>
                


<script type="text/javascript">
    
    var mybUserKey = "myclientID";
    var mybToken = "myToken";

    var myBAcqProcess = new MyBAcquisitionProcess({
        serviceClientID: mybUserKey,
        serviceToken: mybToken,
        retryLimit: 3 
    });


    function onOpenCvReady() {
        console.log("OpenCV loaded");
        myBAcqProcess.start();
    }

    async function onSendCapturedData(upload_image, documentSide) {
        await fetch("Your BackEnd url to upload document", {
            method: "POST", // or 'PUT'
            headers: {
                "Content-Type": "application/json",
            },
            body: data,
        })
            .catch((error) => {
                console.log("Network Error");
                throw new Error("Failed to fetch data. NetworkError");
            })
            .then((response) => {
                if (!response.ok) {
                    // get error message from body or default to response status
                    throw new Error("Failed response status code");
                }
                onAcquisitionSuccess();
                myBAcqProcess.showNextStep();
                return response.json();
            })
            .then((data) => {
            })
            .catch((error) => {
                onAcquisitionError();
                myBAcqProcess.stop();
            });
    }

		function onAcquisitionError() {
        // this will be trigger when retryLimit Exeeded or fatal error occur.
    }

    function onCroppingError(e) {
        // this occur when the picture processing and validation fails. Should be used to send notification to the user
    }

    function onAcquisitionSuccess() {
        // this will be triggerd at the end of acquisition ( both front and back acquired) after the back document send event is triggered.
    }

    myBAcqProcess.setAcquisitionActionsCallBack({
        onProcessError: onAcquisitionError,
        onCroppingError: onCroppingError,
        onSendDocument: onSendCapturedData,
        onAcquisitionEnd: onAcquisitionSuccess,
    });
</script>

